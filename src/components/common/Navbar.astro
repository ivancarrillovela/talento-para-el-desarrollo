---
import { reader } from "../../utils/keystatic";
import { SITE_INFO, NAV_LINKS, FOOTER_LINKS } from "../../constants";
import Footer from "./Footer.astro";
import LanguageSwitcher from "./LanguageSwitcher.astro";

const globalData = await reader.singletons.global.read();
const nombre = globalData?.nombreSitio || SITE_INFO.name;
const logo = globalData?.logo || null;
---

<nav
  id="navbar"
  class="fixed w-full z-50 transition-all duration-300 bg-white shadow-none py-4"
>
  <div
    class="container mx-auto px-6 lg:px-12 flex justify-between items-center"
  >
    <a
      href="/"
      class="text-2xl font-bold text-zinc-900 flex items-center gap-2"
    >
      {
        logo ? (
          <img
            src={logo}
            alt={nombre}
            class="h-10 w-auto"
            onerror="this.onerror=null;this.src='/images/no_image.jpg';"
          />
        ) : (
          <span class="text-zinc-900 font-serif tracking-tighter">
            {nombre}
          </span>
        )
      }
    </a>

    <div class="hidden md:flex items-center gap-8">
      {
        NAV_LINKS.map((link) => (
          <a
            href={link.href}
            class="group relative text-sm font-medium text-zinc-700 hover:text-terracotta-500 transition-colors py-1"
          >
            {link.label}
            <span class="absolute bottom-0 left-0 w-full h-0.5 bg-terracotta-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left" />
          </a>
        ))
      }

      <LanguageSwitcher />

      <a
        href="#contacto"
        class="px-5 py-2.5 bg-zinc-900 text-white text-sm font-medium rounded-sm hover:bg-terracotta-500 transition-colors"
      >
        Colaborar
      </a>
    </div>

    <button
      id="menu-btn"
      class="md:hidden z-50 relative w-10 h-10 flex items-center justify-center text-zinc-900"
      aria-label="Menu"
    >
      {/* Icono Hamburguesa (Normal) */}
      <svg
        id="icon-menu"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-8 h-8 transition-transform duration-300"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
      </svg>

      {/* Icono X (Cerrar) */}
      <svg
        id="icon-close"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-8 h-8 absolute inset-0 m-auto opacity-0 scale-75 transition-all duration-300"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    {/* Superposición del menú móvil - Blanco sólido */}
    <div
      id="mobile-menu"
      class="fixed inset-0 bg-white z-40 flex flex-col px-8 pt-28 pb-10 transition-transform duration-300 translate-x-full md:hidden"
    >
      {/* Selector de idioma — Arriba */}
      <div class="flex items-center justify-center gap-3 mb-6 mobile-nav-lang">
        <span
          class="text-[11px] font-medium text-zinc-400 uppercase tracking-[0.15em]"
          >Idioma</span
        >
        <span class="w-1 h-px bg-zinc-200"></span>
        <LanguageSwitcher />
      </div>

      {/* Navegación — Diseño editorial premium */}
      <nav
        class="mobile-nav flex flex-col items-stretch border-t border-zinc-200/60"
      >
        {
          NAV_LINKS.map((link, index) => (
            <a
              href={link.href}
              class="mobile-nav-link group relative flex items-center justify-between py-8 border-b border-zinc-200/60 overflow-hidden"
              style={`--i: ${index}`}
            >
              {/* Acento lateral izquierdo */}
              <span class="absolute left-0 top-0 bottom-0 w-[3px] bg-terracotta-500 transform scale-y-0 group-hover:scale-y-100 transition-transform duration-400 ease-out origin-top" />

              {/* Fondo animado en hover */}
              <span class="absolute inset-0 bg-zinc-50/70 origin-left transform scale-x-0 group-hover:scale-x-100 transition-transform duration-500 ease-out" />

              {/* Texto del enlace */}
              <span class="relative pl-4 text-[1.25rem] font-medium text-zinc-700 group-hover:text-zinc-900 transition-colors duration-300 leading-relaxed uppercase tracking-[0.18em]">
                {link.label}
              </span>

              {/* Línea decorativa + flecha */}
              <span class="relative flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-all duration-500">
                <span class="block w-8 h-px bg-terracotta-500" />
                <svg
                  class="w-3.5 h-3.5 text-terracotta-500 -translate-x-2 group-hover:translate-x-0 transition-transform duration-500 ease-out"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M9 5l7 7-7 7"
                  />
                </svg>
              </span>
            </a>
          ))
        }
      </nav>

      {/* CTA + Footer pegados abajo */}
      <div class="mt-auto">
        <a
          href="#contacto"
          class="flex items-center justify-center w-full py-3.5 mb-6 bg-zinc-900 text-white text-base font-medium rounded-md hover:bg-terracotta-500 transition-colors shadow-sm"
        >
          Colabora con nosotros
        </a>
        <Footer variant="mobile" />
      </div>
    </div>
  </div>
</nav>

<script>
  // Lógica del menú móvil
  const menuBtn = document.getElementById("menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileLinks = mobileMenu?.querySelectorAll("a");
  const iconMenu = document.getElementById("icon-menu");
  const iconClose = document.getElementById("icon-close");
  const body = document.body;
  const nav = document.getElementById("navbar");

  function toggleMenu() {
    const isOpen = mobileMenu?.classList.contains("translate-x-0");

    if (isOpen) {
      // CERRAR
      mobileMenu?.classList.remove("translate-x-0");
      mobileMenu?.classList.add("translate-x-full");

      // Lógica de iconos: Mostrar hamburguesa
      iconMenu?.classList.remove("opacity-0", "rotate-90", "scale-75");
      iconClose?.classList.add("opacity-0", "scale-75");
      iconClose?.classList.remove("rotate-90");

      body.style.overflow = ""; // Habilitar scroll
    } else {
      // ABRIR
      mobileMenu?.classList.remove("translate-x-full");
      mobileMenu?.classList.add("translate-x-0");

      // Reiniciar animaciones de entrada
      mobileMenu
        ?.querySelectorAll(".mobile-nav-link, .mobile-nav-lang")
        .forEach((el) => {
          el.classList.remove("animate-in");
          void (el as HTMLElement).offsetWidth; // Forzar reflow
          el.classList.add("animate-in");
        });

      // Lógica de iconos: Mostrar X
      iconMenu?.classList.add("opacity-0", "rotate-90", "scale-75");
      iconClose?.classList.remove("opacity-0", "scale-75");
      iconClose?.classList.add("rotate-90");

      body.style.overflow = "hidden"; // Deshabilitar scroll
    }
  }

  menuBtn?.addEventListener("click", toggleMenu);

  // Cerrar menú al hacer clic en un enlace
  mobileLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu?.classList.remove("translate-x-0");
      mobileMenu?.classList.add("translate-x-full");

      // Restablecer iconos
      iconMenu?.classList.remove("opacity-0", "rotate-90", "scale-75");
      iconClose?.classList.add("opacity-0", "scale-75");
      iconClose?.classList.remove("rotate-90");

      body.style.overflow = "";
    });
  });

  // Animación de scroll (Escritorio)
  function updateNavScroll() {
    if (window.scrollY > 20) {
      nav?.classList.remove("py-4", "shadow-none");
      nav?.classList.add("py-3", "shadow-sm");
    } else {
      nav?.classList.add("py-4", "shadow-none");
      nav?.classList.remove("py-3", "shadow-sm");
    }
  }

  window.addEventListener("scroll", updateNavScroll);
</script>

<style>
  /* Animación de entrada escalonada */
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(16px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .mobile-nav-link,
  .mobile-nav-lang {
    opacity: 0;
  }

  .mobile-nav-link.animate-in,
  .mobile-nav-lang.animate-in {
    animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    animation-delay: calc(var(--i, 4) * 80ms + 150ms);
  }
</style>
