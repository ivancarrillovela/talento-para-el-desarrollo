---
import { reader } from "../../utils/keystatic";
import { SITE_INFO, NAV_LINKS, FOOTER_LINKS } from "../../constants";
import Footer from "./Footer.astro";
import LanguageSwitcher from "./LanguageSwitcher.astro";

const globalData = await reader.singletons.global.read();
const nombre = globalData?.nombreSitio || SITE_INFO.name;
const logo = globalData?.logo || null;
---

<nav
  id="navbar"
  class="fixed w-full z-50 transition-all duration-300 bg-white shadow-none py-4"
>
  <div
    class="container mx-auto px-6 lg:px-12 flex justify-between items-center"
  >
    <a
      href="/"
      class="text-2xl font-bold text-zinc-900 flex items-center gap-2"
    >
      {
        logo ? (
          <img
            src={logo}
            alt={nombre}
            class="h-10 w-auto"
            onerror="this.onerror=null;this.src='/images/no_image.jpg';"
          />
        ) : (
          <span class="text-zinc-900 font-serif tracking-tighter">
            {nombre}
          </span>
        )
      }
    </a>

    <div class="hidden md:flex items-center gap-8">
      {
        NAV_LINKS.map((link) => (
          <a
            href={link.href}
            class="group relative text-sm font-medium text-zinc-700 hover:text-terracotta-500 transition-colors py-1"
          >
            {link.label}
            <span class="absolute bottom-0 left-0 w-full h-0.5 bg-terracotta-500 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left" />
          </a>
        ))
      }

      <LanguageSwitcher />

      <a
        href="#contacto"
        class="px-5 py-2.5 bg-zinc-900 text-white text-sm font-medium rounded-sm hover:bg-terracotta-500 transition-colors"
      >
        Colaborar
      </a>
    </div>

    <button
      id="menu-btn"
      class="md:hidden z-50 relative w-10 h-10 flex items-center justify-center text-zinc-900"
      aria-label="Menu"
    >
      {/* Icono Hamburguesa (Normal) */}
      <svg
        id="icon-menu"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-8 h-8 transition-transform duration-300"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
      </svg>

      {/* Icono X (Cerrar) */}
      <svg
        id="icon-close"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-8 h-8 absolute inset-0 m-auto opacity-0 scale-75 transition-all duration-300"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"></path>
      </svg>
    </button>

    {/* Superposición del menú móvil - Blanco sólido */}
    <div
      id="mobile-menu"
      class="fixed inset-0 bg-white z-40 flex flex-col px-8 pt-28 pb-10 transition-transform duration-300 translate-x-full md:hidden"
    >
      {/* CTA Superior */}
      <div class="mb-10">
        <a
          href="#contacto"
          class="flex items-center justify-center w-full py-3.5 bg-zinc-900 text-white text-base font-medium rounded-md hover:bg-terracotta-500 transition-colors shadow-sm"
        >
          Colabora con nosotros
        </a>
      </div>

      {/* Enlaces de navegación */}
      <nav class="flex flex-col gap-6 items-start">
        {
          NAV_LINKS.map((link) => (
            <a
              href={link.href}
              class="text-3xl font-serif text-zinc-900 hover:text-terracotta-500 transition-colors"
            >
              {link.label}
            </a>
          ))
        }
        <div class="mt-4">
          <LanguageSwitcher />
        </div>
      </nav>

      {/* Pie de menú - Refleja Footer.astro */}
      <Footer variant="mobile" />
    </div>
  </div>
</nav>

<script>
  // Lógica del menú móvil
  const menuBtn = document.getElementById("menu-btn");
  const mobileMenu = document.getElementById("mobile-menu");
  const mobileLinks = mobileMenu?.querySelectorAll("a");
  const iconMenu = document.getElementById("icon-menu");
  const iconClose = document.getElementById("icon-close");
  const body = document.body;
  const nav = document.getElementById("navbar");

  function toggleMenu() {
    const isOpen = mobileMenu?.classList.contains("translate-x-0");

    if (isOpen) {
      // CERRAR
      mobileMenu?.classList.remove("translate-x-0");
      mobileMenu?.classList.add("translate-x-full");

      // Lógica de iconos: Mostrar hamburguesa
      iconMenu?.classList.remove("opacity-0", "rotate-90", "scale-75");
      iconClose?.classList.add("opacity-0", "scale-75");
      iconClose?.classList.remove("rotate-90");

      body.style.overflow = ""; // Habilitar scroll
    } else {
      // ABRIR
      mobileMenu?.classList.remove("translate-x-full");
      mobileMenu?.classList.add("translate-x-0");

      // Lógica de iconos: Mostrar X
      iconMenu?.classList.add("opacity-0", "rotate-90", "scale-75");
      iconClose?.classList.remove("opacity-0", "scale-75");
      iconClose?.classList.add("rotate-90");

      body.style.overflow = "hidden"; // Deshabilitar scroll
    }
  }

  menuBtn?.addEventListener("click", toggleMenu);

  // Cerrar menú al hacer clic en un enlace
  mobileLinks?.forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu?.classList.remove("translate-x-0");
      mobileMenu?.classList.add("translate-x-full");

      // Restablecer iconos
      iconMenu?.classList.remove("opacity-0", "rotate-90", "scale-75");
      iconClose?.classList.add("opacity-0", "scale-75");
      iconClose?.classList.remove("rotate-90");

      body.style.overflow = "";
    });
  });

  // Animación de scroll (Escritorio)
  function updateNavScroll() {
    if (window.scrollY > 20) {
      nav?.classList.remove("py-4", "shadow-none");
      nav?.classList.add("py-3", "shadow-sm");
    } else {
      nav?.classList.add("py-4", "shadow-none");
      nav?.classList.remove("py-3", "shadow-sm");
    }
  }

  window.addEventListener("scroll", updateNavScroll);
</script>
