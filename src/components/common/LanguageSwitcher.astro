---
interface Props {
  theme?: "light" | "dark";
}

const { theme = "light" } = Astro.props;
---

<div
  class="language-switcher flex items-center gap-2 text-sm font-medium wg-exclude notranslate"
  data-wg-notranslate
  data-theme={theme}
>
  <button
    class="lang-es text-zinc-900 font-bold transition-colors"
    aria-label="Cambiar a EspaÃ±ol"
  >
    ES
  </button>
  <span class="separator text-zinc-300">|</span>
  <button
    class="lang-en text-zinc-400 transition-colors"
    aria-label="Switch to English"
  >
    EN
  </button>
</div>

<script>
  // @ts-ignore
  Weglot.on("initialized", () => {
    // @ts-ignore
    const currentLang = Weglot.getCurrentLang();
    updateAllSwitchers(currentLang);
  });

  // @ts-ignore
  Weglot.on("languageChanged", (newLang) => {
    updateAllSwitchers(newLang);
  });

  function updateAllSwitchers(lang: string) {
    const switchers = document.querySelectorAll(".language-switcher");

    switchers.forEach((switcher) => {
      const theme = (switcher as HTMLElement).dataset.theme || "light";
      const btnEs = switcher.querySelector(".lang-es");
      const btnEn = switcher.querySelector(".lang-en");
      const separator = switcher.querySelector(".separator");

      // Reset base classes
      btnEs?.classList.remove(
        "font-bold",
        "text-zinc-900",
        "text-zinc-400",
        "text-white",
        "text-zinc-500",
      );
      btnEn?.classList.remove(
        "font-bold",
        "text-zinc-900",
        "text-zinc-400",
        "text-white",
        "text-zinc-500",
      );
      separator?.classList.remove("text-zinc-300", "text-zinc-600");

      if (theme === "light") {
        separator?.classList.add("text-zinc-300");
        if (lang === "es") {
          btnEs?.classList.add("text-zinc-900", "font-bold");
          btnEn?.classList.add("text-zinc-400");
        } else {
          btnEn?.classList.add("text-zinc-900", "font-bold");
          btnEs?.classList.add("text-zinc-400");
        }
      } else {
        // Dark Theme
        separator?.classList.add("text-zinc-600");
        if (lang === "es") {
          btnEs?.classList.add("text-white", "font-bold");
          btnEn?.classList.add("text-zinc-500", "hover:text-white");
        } else {
          btnEn?.classList.add("text-white", "font-bold");
          btnEs?.classList.add("text-zinc-500", "hover:text-white");
        }
      }
    });
  }

  // Event Listeners for click
  document.addEventListener("click", (e) => {
    const target = e.target as HTMLElement;

    if (target.classList.contains("lang-es")) {
      // @ts-ignore
      Weglot.switchTo("es");
    }

    if (target.classList.contains("lang-en")) {
      // @ts-ignore
      Weglot.switchTo("en");
    }
  });
</script>
